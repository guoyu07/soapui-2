{
  try {
    if (path == null) {
      File file=UISupport.getFileDialogs().saveAs(this,messages.get("SaveWorkspace.Title"),".xml","XML Files (*.xml)",null);
      if (file == null) {
        return SaveStatus.CANCELLED;
      }
      path=file.getAbsolutePath();
    }
    List<WorkspaceProjectConfig> projects=new ArrayList<WorkspaceProjectConfig>();
    for (int c=0; c < getProjectCount(); c++) {
      WsdlProject project=(WsdlProject)getProjectAt(c);
      if (!saveWorkspaceOnly) {
        SaveStatus status=SaveStatus.FAILED;
        while (status == SaveStatus.FAILED) {
          status=saveProject(skipProjectsWithRunningTests,project);
        }
        if (status == SaveStatus.CANCELLED) {
          return status;
        }
        if (status == SaveStatus.DONT_SAVE) {
          continue;
        }
      }
      saveWorkspace(projects,project);
    }
    workspaceConfig.getSoapuiWorkspace().setProjectArray(projects.toArray(new WorkspaceProjectConfig[projects.size()]));
    workspaceConfig.getSoapuiWorkspace().setSoapuiVersion(SoapUI.SOAPUI_VERSION);
    File workspaceFile=new File(path);
    workspaceConfig.save(workspaceFile,new XmlOptions().setSavePrettyPrint());
    log.info(messages.get("SavedWorkspace.Info",workspaceFile.getAbsolutePath()));
  }
 catch (  IOException e) {
    log.error(messages.get("FailedToSaveWorkspace.Error") + e.getMessage(),e);
    return SaveStatus.FAILED;
  }
  return SaveStatus.SUCCESS;
}
