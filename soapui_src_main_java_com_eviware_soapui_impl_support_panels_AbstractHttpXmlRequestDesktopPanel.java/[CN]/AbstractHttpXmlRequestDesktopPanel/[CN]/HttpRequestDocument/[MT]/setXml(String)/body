{
  if (!updating) {
    updating=true;
    try {
      if (seemsToBeJsonContentType(getRequest().getMediaType()) && XmlUtils.seemsToBeXml(xml)) {
        JSON json=new JsonXmlSerializer().read(xml);
        processNullsAndEmptyValuesIn(json);
        request.setRequestContent(json.toString(3,0));
      }
 else {
        request.setRequestContent(xml);
      }
    }
  finally {
      updating=false;
    }
  }
}
