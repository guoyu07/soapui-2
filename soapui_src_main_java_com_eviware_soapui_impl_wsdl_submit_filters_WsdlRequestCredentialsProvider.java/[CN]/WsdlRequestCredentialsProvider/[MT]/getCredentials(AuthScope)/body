{
  if (checkedCredentials) {
    throw new IllegalArgumentException("Missing valid credentials");
  }
  if (authScope == null) {
    throw new IllegalArgumentException("Authentication scope may not be null");
  }
  try {
    String password=wsdlRequest.getPassword();
    if (password == null)     password="";
    if (AuthPolicy.NTLM.equalsIgnoreCase(authScope.getScheme())) {
      logger.info(authScope.getHost() + ":" + authScope.getPort()+ " requires Windows authentication");
      String workstation="";
      try {
        workstation=InetAddress.getLocalHost().getHostName();
      }
 catch (      UnknownHostException e) {
      }
      return new NTCredentials(wsdlRequest.getUsername(),password,workstation,wsdlRequest.getDomain());
    }
 else     if (AuthPolicy.BASIC.equalsIgnoreCase(authScope.getScheme()) || AuthPolicy.DIGEST.equalsIgnoreCase(authScope.getScheme()) || AuthPolicy.SPNEGO.equalsIgnoreCase(authScope.getScheme())) {
      logger.info(authScope.getHost() + ":" + authScope.getPort()+ " requires authentication with the realm '"+ authScope.getRealm()+ "'");
      return new UsernamePasswordCredentials(wsdlRequest.getUsername(),password);
    }
  }
  finally {
    checkedCredentials=true;
  }
  logger.error("Unsupported authentication scheme: " + authScope.getScheme());
  return null;
}
