{
  Object manualProxy=request.getParams().getParameter(ConnRoutePNames.DEFAULT_PROXY);
  if (manualProxy == null && autoProxyEnabled) {
    CachedProxySelector proxySelector=getProxySelector();
    if (proxySelector != null) {
      return new ProxySelectorRoutePlanner(registry,proxySelector.getProxySelector()).determineRoute(target,request,context);
    }
  }
  return defaultHttpRoutePlanner.determineRoute(target,request,context);
}
