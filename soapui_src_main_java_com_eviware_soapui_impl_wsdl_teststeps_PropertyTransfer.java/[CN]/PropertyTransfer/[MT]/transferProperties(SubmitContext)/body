{
  TestProperty sourceProperty=getSourceProperty();
  TestProperty targetProperty=getTargetProperty();
  try {
    if (sourceProperty == null) {
      throw new Exception("Missing source property");
    }
    if (targetProperty == null) {
      throw new Exception("Missing target property");
    }
    if (sourceProperty.getValue() == null && !getSetNullOnMissingSource() && !getIgnoreEmpty()) {
      throw new Exception("Source property is null");
    }
    if (bothPathsAreXmlBased()) {
      return transferXPathToXml(getSourceProperty(),getTargetProperty(),context);
    }
 else {
      String sourceValue=readSourceValue(context);
      if (StringUtils.hasContent(sourceValue) && getEntitize()) {
        sourceValue=XmlUtils.entitize(sourceValue);
      }
      return writeTargetValue(sourceValue,context);
    }
  }
 catch (  Exception e) {
    throw new PropertyTransferException(e.getMessage(),getSourceStepName(),sourceProperty,getTargetStepName(),targetProperty);
  }
}
