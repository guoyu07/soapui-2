{
  FormLayout layout=new FormLayout("5px,100px,5px,left:default,5px:grow(1.0)");
  final XFormDialog dialog=ADialogBuilder.buildDialog(AuthorizationTypeForm.class,null,layout);
  ArrayList<String> options=new ArrayList<String>();
  options.add(CredentialsConfig.AuthType.GLOBAL_HTTP_SETTINGS.toString());
  options.add(CredentialsConfig.AuthType.PREEMPTIVE.toString());
  options.add(CredentialsConfig.AuthType.NTLM.toString());
  options.add(CredentialsConfig.AuthType.SPNEGO_KERBEROS.toString());
  if (request instanceof RestRequest) {
    options.add(CredentialsConfig.AuthType.O_AUTH_2.toString());
  }
  options.removeAll(request.getBasicAuthenticationProfiles());
  final JLabelFormField hintTextLabel=(JLabelFormField)dialog.getFormField(AuthorizationTypeForm.OAUTH2_PROFILE_NAME_HINT_TEXT_LABEL);
  hintTextLabel.getComponent().setForeground(SimpleForm.HINT_TEXT_COLOR);
  final JTextFieldFormField profileNameField=(JTextFieldFormField)dialog.getFormField(AuthorizationTypeForm.OAUTH2_PROFILE_NAME_FIELD);
  int nextProfileIndex=getOAuth2ProfileContainer().getOAuth2ProfileList().size() + 1;
  profileNameField.setValue("OAuth 2 - Profile " + nextProfileIndex);
  profileNameField.getComponent().setVisible(false);
  profileNameField.addFormFieldListener(new XFormFieldListener(){
    @Override public void valueChanged(    XFormField sourceField,    String newValue,    String oldValue){
      ActionList actionsList=dialog.getActionsList();
      for (int actionIndex=0; actionIndex < actionsList.getActionCount(); actionIndex++) {
        Action action=actionsList.getActionAt(actionIndex);
        if (action.getValue(Action.NAME).equals("OK")) {
          if (StringUtils.isNullOrEmpty(newValue)) {
            action.setEnabled(false);
          }
 else {
            action.setEnabled(true);
          }
        }
      }
    }
  }
);
  JComboBoxFormField authorizationTypesComboBox=(JComboBoxFormField)dialog.getFormField(AuthorizationTypeForm.AUTHORIZATION_TYPE);
  authorizationTypesComboBox.setOptions(options.toArray(new String[options.size()]));
  authorizationTypesComboBox.addFormFieldListener(new XFormFieldListener(){
    @Override public void valueChanged(    XFormField sourceField,    String newValue,    String oldValue){
      showProfileNameField(newValue,profileNameField,hintTextLabel);
    }
  }
);
  showProfileNameField(request.getAuthType(),profileNameField,hintTextLabel);
  dialog.setValue(AuthorizationTypeForm.AUTHORIZATION_TYPE,request.getAuthType());
  if (dialog.show()) {
    final String authType=dialog.getValue(AuthorizationTypeForm.AUTHORIZATION_TYPE);
    if (CredentialsConfig.AuthType.O_AUTH_2.toString().equals(authType)) {
      final String profileName=dialog.getValue(AuthorizationTypeForm.OAUTH2_PROFILE_NAME_FIELD);
      final OAuth2Profile profile=getOAuth2ProfileContainer().addNewOAuth2Profile(profileName);
      request.setSelectedAuthProfile(profile.getName());
    }
 else {
      request.addBasicAuthenticationProfile(authType);
      request.setSelectedAuthProfile(authType);
    }
  }
}
