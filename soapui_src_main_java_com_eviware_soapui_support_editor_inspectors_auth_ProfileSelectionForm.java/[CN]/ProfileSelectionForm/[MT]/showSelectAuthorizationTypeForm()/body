{
  final XFormDialog dialog=ADialogBuilder.buildDialog(AuthorizationTypeForm.class);
  ArrayList<String> options=new ArrayList<String>();
  options.add(CredentialsConfig.AuthType.GLOBAL_HTTP_SETTINGS.toString());
  options.add(CredentialsConfig.AuthType.PREEMPTIVE.toString());
  options.add(CredentialsConfig.AuthType.NTLM.toString());
  options.add(CredentialsConfig.AuthType.SPNEGO_KERBEROS.toString());
  if (request instanceof RestRequest) {
    options.add(CredentialsConfig.AuthType.O_AUTH_2.toString());
  }
  options.removeAll(request.getBasicAuthenticationProfiles());
  final JTextFieldFormField profileNameField=(JTextFieldFormField)dialog.getFormField(AuthorizationTypeForm.OAUTH2_PROFILE_NAME_FIELD);
  int nextProfileIndex=createOAuth2ProfileNameList().size() + 1;
  profileNameField.setValue("OAuth 2 - Profile " + nextProfileIndex);
  profileNameField.getComponent().setVisible(false);
  profileNameField.addFormFieldListener(new XFormFieldListener(){
    @Override public void valueChanged(    XFormField sourceField,    String newValue,    String oldValue){
      ActionList actionsList=dialog.getActionsList();
      for (int actionIndex=0; actionIndex < actionsList.getActionCount(); actionIndex++) {
        Action action=actionsList.getActionAt(actionIndex);
        if (action.getValue(Action.NAME).equals("OK")) {
          if (StringUtils.isNullOrEmpty(newValue)) {
            action.setEnabled(false);
          }
 else {
            action.setEnabled(true);
          }
        }
      }
    }
  }
);
  JComboBoxFormField authorizationTypesComboBox=(JComboBoxFormField)dialog.getFormField(AuthorizationTypeForm.AUTHORIZATION_TYPE);
  authorizationTypesComboBox.setOptions(options.toArray(new String[options.size()]));
  authorizationTypesComboBox.addFormFieldListener(new XFormFieldListener(){
    @Override public void valueChanged(    XFormField sourceField,    String newValue,    String oldValue){
      if (newValue.equals(CredentialsConfig.AuthType.O_AUTH_2.toString())) {
        profileNameField.getComponent().setVisible(true);
      }
 else {
        profileNameField.getComponent().setVisible(false);
      }
    }
  }
);
  dialog.setValue(AuthorizationTypeForm.AUTHORIZATION_TYPE,request.getAuthType());
  if (dialog.show()) {
    final String authType=dialog.getValue(AuthorizationTypeForm.AUTHORIZATION_TYPE);
    if (getBasicAuthenticationTypes().contains(authType)) {
      request.addBasicAuthenticationProfile(authType);
      SwingUtilities.invokeLater(new Runnable(){
        @Override public void run(){
          refreshProfileSelectionComboBox(authType);
        }
      }
);
    }
 else     if (CredentialsConfig.AuthType.O_AUTH_2.toString().equals(authType)) {
      String profileName=dialog.getValue(AuthorizationTypeForm.OAUTH2_PROFILE_NAME_FIELD);
      final OAuth2Profile profile=getOAuth2ProfileContainer().addNewOAuth2Profile(profileName);
      SwingUtilities.invokeLater(new Runnable(){
        @Override public void run(){
          refreshProfileSelectionComboBox(profile.getName());
        }
      }
);
    }
  }
}
