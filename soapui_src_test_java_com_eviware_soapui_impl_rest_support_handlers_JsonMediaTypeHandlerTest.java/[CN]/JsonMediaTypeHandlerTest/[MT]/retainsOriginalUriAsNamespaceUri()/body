{
  RestRequest restRequest=makeRestRequest();
  restRequest.setEndpoint(ENDPOINT);
  String originalPath="/original/path";
  restRequest.setPath(originalPath);
  SubmitContext mock=mock(SubmitContext.class);
  ExtendedHttpMethod httpMethod=prepareHttpMethodWith(originalPath);
  when(mock.getProperty(BaseHttpRequestTransport.HTTP_METHOD)).thenReturn(httpMethod);
  when(mock.getProperty(BaseHttpRequestTransport.REQUEST_URI)).thenReturn(new URI(ENDPOINT + originalPath));
  restRequest.submit(mock,false);
  HttpResponse response=makeResponseFor(restRequest,originalPath);
  JsonMediaTypeHandler handler=new JsonMediaTypeHandler();
  String originalXml=handler.createXmlRepresentation(response);
  System.out.println("originalXml = " + originalXml);
  String anotherPath="/another/path";
  restRequest.setPath(anotherPath);
  httpMethod=prepareHttpMethodWith(originalPath);
  when(mock.getProperty(BaseHttpRequestTransport.HTTP_METHOD)).thenReturn(httpMethod);
  when(mock.getProperty(BaseHttpRequestTransport.REQUEST_URI)).thenReturn(new URI(ENDPOINT + anotherPath));
  restRequest.submit(mock(SubmitContext.class),false);
  HttpResponse responseWithNewPath=makeResponseFor(restRequest,anotherPath);
  assertThat(handler.createXmlRepresentation(responseWithNewPath),is(originalXml));
}
