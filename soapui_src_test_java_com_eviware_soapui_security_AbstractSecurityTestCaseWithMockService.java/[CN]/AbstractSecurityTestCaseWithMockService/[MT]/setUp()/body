{
  WsdlProject project=new WsdlProject(AbstractSecurityTestCaseWithMockService.class.getResource("/sample-soapui-project.xml").getPath());
  TestSuite testSuite=project.getTestSuiteByName("Test Suite");
  testCase=(WsdlTestCase)testSuite.getTestCaseByName("Test Conversions");
  WsdlInterface iface=(WsdlInterface)project.getInterfaceAt(0);
  mockService=project.addNewMockService("MockService 1");
  mockService.setPort(9081);
  mockService.setPath("/testmock");
  WsdlOperation operation=iface.getOperationAt(0);
  WsdlMockOperation mockOperation=mockService.addNewMockOperation(operation);
  WsdlMockResponse mockResponse=mockOperation.addNewMockResponse("Test Response",true);
  mockResponse.setResponseContent("Tjohoo!");
  mockService.start();
  String endpoint="http://" + mockService.getHost() + ":"+ mockService.getPort()+ mockService.getPath();
  iface.addEndpoint(endpoint);
  List<TestStep> testStepList=testCase.getTestStepList();
  for (  TestStep testStep : testStepList) {
    if (testStep instanceof WsdlTestRequestStep) {
      ((WsdlTestRequestStep)testStep).getTestRequest().setEndpoint(endpoint);
    }
    if (testStep instanceof HttpTestRequestStep) {
      ((HttpTestRequestStep)testStep).getTestRequest().setEndpoint(endpoint);
    }
  }
}
