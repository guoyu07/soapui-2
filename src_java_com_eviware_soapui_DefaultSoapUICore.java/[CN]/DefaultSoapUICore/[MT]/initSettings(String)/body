{
  try {
    File settingsFile=root == null ? new File(fileName) : new File(new File(root),fileName);
    if (!settingsFile.exists()) {
      if (settingsDocument == null) {
        log.info("Creating new settings at [" + settingsFile.getAbsolutePath() + "]");
        settingsDocument=SoapuiSettingsDocumentConfig.Factory.newInstance();
      }
    }
 else {
      settingsDocument=SoapuiSettingsDocumentConfig.Factory.parse(settingsFile);
      byte[] encryptedContent=settingsDocument.getSoapuiSettings().getEncryptedContent();
      if (encryptedContent != null) {
        JPasswordField passwordField=new JPasswordField();
        JLabel qLabel=new JLabel("Password");
        JOptionPane.showConfirmDialog(null,new Object[]{qLabel,passwordField},"Global Settings",JOptionPane.OK_CANCEL_OPTION);
        char[] password=passwordField.getPassword();
        byte[] data=OpenSSL.decrypt("des3",password,encryptedContent);
        settingsDocument=SoapuiSettingsDocumentConfig.Factory.parse(new String(data,"UTF-8"));
      }
      log.info("initialized soapui-settings from [" + settingsFile.getAbsolutePath() + "]");
    }
  }
 catch (  Exception e) {
    log.warn("Failed to load settings from [" + e.getMessage() + "], creating new");
    settingsDocument=SoapuiSettingsDocumentConfig.Factory.newInstance();
  }
  if (settingsDocument.getSoapuiSettings() == null) {
    settingsDocument.addNewSoapuiSettings();
    settings=new XmlBeansSettingsImpl(null,null,settingsDocument.getSoapuiSettings());
    initDefaultSettings(settings);
  }
 else {
    settings=new XmlBeansSettingsImpl(null,null,settingsDocument.getSoapuiSettings());
  }
  this.settingsFile=fileName;
  if (!settings.isSet(WsdlSettings.EXCLUDED_TYPES)) {
    StringList list=new StringList();
    list.add("schema@http://www.w3.org/2001/XMLSchema");
    settings.setString(WsdlSettings.EXCLUDED_TYPES,list.toXml());
  }
  if (!settings.isSet(WsdlSettings.NAME_WITH_BINDING)) {
    settings.setBoolean(WsdlSettings.NAME_WITH_BINDING,true);
  }
  if (!settings.isSet(HttpSettings.MAX_CONNECTIONS_PER_HOST)) {
    settings.setLong(HttpSettings.MAX_CONNECTIONS_PER_HOST,500);
  }
  if (!settings.isSet(HttpSettings.MAX_TOTAL_CONNECTIONS)) {
    settings.setLong(HttpSettings.MAX_TOTAL_CONNECTIONS,2000);
  }
  return settings;
}
