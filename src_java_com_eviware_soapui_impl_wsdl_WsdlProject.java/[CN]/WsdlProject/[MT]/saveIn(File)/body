{
  long size=0;
  beforeSave();
  SoapuiProjectDocumentConfig projectDocument=(SoapuiProjectDocumentConfig)this.projectDocument.copy();
  String passwordForEncryption=getSettings().getString(ProjectSettings.SHADOW_PASSWORD,null);
  if (projectDocument.getSoapuiProject().getEncryptedContent() == null) {
    if (passwordForEncryption != null) {
      if (passwordForEncryption.length() > 1) {
        try {
          String data=getConfig().xmlText();
          byte[] encrypted=OpenSSL.encrypt("des3",passwordForEncryption.toCharArray(),data.getBytes());
          projectDocument.getSoapuiProject().setEncryptedContent(encrypted);
          projectDocument.getSoapuiProject().setInterfaceArray(null);
          projectDocument.getSoapuiProject().setTestSuiteArray(null);
          projectDocument.getSoapuiProject().setMockServiceArray(null);
          projectDocument.getSoapuiProject().unsetSettings();
          projectDocument.getSoapuiProject().unsetProperties();
        }
 catch (        GeneralSecurityException e) {
          UISupport.showErrorMessage("Encryption Error");
        }
      }
 else {
        projectDocument.getSoapuiProject().setEncryptedContent(null);
      }
    }
  }
  XmlOptions options=new XmlOptions();
  if (SoapUI.getSettings().getBoolean(WsdlSettings.PRETTY_PRINT_PROJECT_FILES))   options.setSavePrettyPrint();
  if (!getSettings().getBoolean(WsdlSettings.CACHE_WSDLS)) {
    SoapuiProjectDocumentConfig config=(SoapuiProjectDocumentConfig)projectDocument.copy();
    removeDefinitionCaches(config);
    config.getSoapuiProject().setSoapuiVersion(SoapUI.SOAPUI_VERSION);
    ByteArrayOutputStream writer=new ByteArrayOutputStream(8192);
    FileWriter fwriter=new FileWriter(projectFile);
    config.save(fwriter,options);
    FileOutputStream out=new FileOutputStream(projectFile);
    String tmpBuffer=fixLineSeparator(writer);
    ByteArrayOutputStream writer2=new ByteArrayOutputStream(8192);
    writer2.write(tmpBuffer.getBytes());
    writer2.writeTo(out);
    out.close();
    size=writer.size();
  }
 else {
    try {
      projectDocument.getSoapuiProject().setSoapuiVersion(SoapUI.SOAPUI_VERSION);
      ByteArrayOutputStream writer=new ByteArrayOutputStream(8192);
      FileWriter fwriter=new FileWriter(projectFile);
      projectDocument.save(fwriter,options);
      FileOutputStream out=new FileOutputStream(projectFile);
      String tmpBuffer=fixLineSeparator(writer);
      ByteArrayOutputStream writer2=new ByteArrayOutputStream(8192);
      writer2.write(tmpBuffer.getBytes());
      writer2.writeTo(out);
      out.close();
      size=writer.size();
    }
 catch (    Throwable t) {
      SoapUI.logError(t);
      UISupport.showErrorMessage("Failed to save project [" + getName() + "]: "+ t.toString());
      return false;
    }
  }
  lastModified=projectFile.lastModified();
  log.info("Saved project [" + getName() + "] to ["+ projectFile.getAbsolutePath()+ " - "+ size+ " bytes");
  setProjectRoot(path);
  return true;
}
