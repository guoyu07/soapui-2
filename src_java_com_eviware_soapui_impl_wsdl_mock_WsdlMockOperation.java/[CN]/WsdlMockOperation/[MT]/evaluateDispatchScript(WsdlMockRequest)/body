{
  String dispatchPath=getDispatchPath();
  if (dispatchPath == null || dispatchPath.trim().length() == 0) {
    throw new DispatchException("Dispatch Script is empty");
  }
  SoapUIScriptEngine scriptEngine=scriptEnginePool.getScriptEngine();
  try {
    WsdlMockService mockService=getMockService();
    WsdlMockRunner mockRunner=mockService.getMockRunner();
    MockRunContext context=mockRunner == null ? new WsdlMockRunContext(mockService,null) : mockRunner.getMockContext();
    scriptEngine.setVariable("context",context);
    scriptEngine.setVariable("requestContext",request == null ? null : request.getRequestContext());
    scriptEngine.setVariable("mockRequest",request);
    scriptEngine.setVariable("mockOperation",this);
    scriptEngine.setVariable("log",SoapUI.ensureGroovyLog());
    scriptEngine.setScript(dispatchPath);
    Object retVal=scriptEngine.run();
    return retVal;
  }
 catch (  Throwable e) {
    SoapUI.logError(e);
    throw new DispatchException("Failed to dispatch using script; " + e);
  }
 finally {
    scriptEnginePool.returnScriptEngine(scriptEngine);
  }
}
