{
  try {
    iconAnimator.start();
    getProperty("Request").setValue(request.getRequestContent());
    long delay=getResponseDelay();
    if (delay > 0)     Thread.sleep(delay);
    String script=getScript();
    if (script != null && script.trim().length() > 0) {
      evaluateScript(request);
    }
    String responseContent=getResponseContent();
    WsdlMockRunContext context=new WsdlMockRunContext(request.getContext().getMockService(),null);
    context.setMockResponse(this);
    context.putAll(request.getContext());
    context.putAll(request.getRequestContext());
    StringToStringMap responseHeaders=getResponseHeaders();
    for (    String name : responseHeaders.keySet()) {
      result.addHeader(name,PropertyExpansionUtils.expandProperties(context,responseHeaders.get(name)));
    }
    responseContent=PropertyExpansionUtils.expandProperties(context,responseContent,true);
    String outgoingWss=getOutgoingWss();
    if (StringUtils.isNullOrEmpty(outgoingWss))     outgoingWss=getMockOperation().getMockService().getOutgoingWss();
    if (StringUtils.hasContent(outgoingWss)) {
      OutgoingWss outgoing=getMockOperation().getMockService().getProject().getWssContainer().getOutgoingWssByName(outgoingWss);
      if (outgoing != null) {
        Document dom=XmlUtils.parseXml(responseContent);
        outgoing.processOutgoing(dom,context);
        StringWriter writer=new StringWriter();
        XmlUtils.serialize(dom,writer);
        responseContent=writer.toString();
      }
    }
    if (!result.isCommitted()) {
      responseContent=writeResponse(result,responseContent);
    }
    result.setResponseContent(responseContent);
    setMockResult(result);
    return mockResult;
  }
 catch (  Throwable e) {
    SoapUI.logError(e);
    throw new DispatchException(e);
  }
 finally {
    iconAnimator.stop();
  }
}
