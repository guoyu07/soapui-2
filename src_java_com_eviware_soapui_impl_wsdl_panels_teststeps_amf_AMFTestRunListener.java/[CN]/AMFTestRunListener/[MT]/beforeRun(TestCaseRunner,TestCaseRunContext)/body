{
  if (testRunner.getTestCase() instanceof WsdlTestCase) {
    try {
      WsdlTestCase wsdlTestCase=(WsdlTestCase)testRunner.getTestCase();
      if (wsdlTestCase.getConfig().getAmfAuthorisation()) {
        if (noAMFTestSteps(wsdlTestCase))         return;
        String endpoint=runContext.expand(wsdlTestCase.getConfig().getAmfEndpoint());
        String username=runContext.expand(wsdlTestCase.getConfig().getAmfLogin());
        String password=runContext.expand(wsdlTestCase.getConfig().getAmfPassword());
        CommandMessage commandMessage=createLoginCommandMessage(username,password);
        SoapUIAMFConnection amfConnection=new SoapUIAMFConnection();
        amfConnection.connect(endpoint);
        amfConnection.call((SubmitContext)runContext,null,commandMessage);
        runContext.setProperty(AMFSubmit.AMF_CONNECTION,amfConnection);
      }
    }
 catch (    ClientStatusException e) {
      SoapUI.logError(e);
    }
catch (    ServerStatusException e) {
      SoapUI.logError(e);
    }
  }
}
