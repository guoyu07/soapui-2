{
  HttpRequestBase httpMethod=(HttpRequestBase)context.getProperty(BaseHttpRequestTransport.HTTP_METHOD);
  if (!StringUtils.isNullOrEmpty(username) && !StringUtils.isNullOrEmpty(password)) {
    if (settings.getBoolean(HttpSettings.AUTHENTICATE_PREEMPTIVELY)) {
      UsernamePasswordCredentials creds=new UsernamePasswordCredentials(username,password);
      Header header=BasicScheme.authenticate(creds,"utf-8",false);
      httpMethod.removeHeaders("Authorization");
      httpMethod.addHeader(header);
    }
    ((HttpUriRequest)httpMethod).getParams().setParameter(ClientContext.CREDS_PROVIDER,new UPDCredentialsProvider(username,password,domain));
  }
}
