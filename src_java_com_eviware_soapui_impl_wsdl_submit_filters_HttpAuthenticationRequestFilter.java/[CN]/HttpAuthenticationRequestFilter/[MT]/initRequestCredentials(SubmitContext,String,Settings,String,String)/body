{
  HttpRequestBase httpMethod=(HttpRequestBase)context.getProperty(BaseHttpRequestTransport.HTTP_METHOD);
  if (!StringUtils.isNullOrEmpty(username) && !StringUtils.isNullOrEmpty(password)) {
    if (settings.getBoolean(HttpSettings.AUTHENTICATE_PREEMPTIVELY)) {
      UsernamePasswordCredentials creds=new UsernamePasswordCredentials(username,password);
      httpMethod.addHeader(BasicScheme.authenticate(creds,"utf-8",false));
    }
    HttpClientSupport.getHttpClient().setCredentialsProvider(new UPDCredentialsProvider(username,password,domain));
  }
}
