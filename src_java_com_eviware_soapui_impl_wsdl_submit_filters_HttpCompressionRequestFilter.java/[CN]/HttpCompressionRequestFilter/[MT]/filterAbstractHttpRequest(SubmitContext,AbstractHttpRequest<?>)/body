{
  Settings settings=httpRequest.getSettings();
  String compressionAlg=settings.getString(HttpSettings.REQUEST_COMPRESSION,"None");
  if (!"None".equals(compressionAlg)) {
    try {
      ExtendedHttpMethod method=(ExtendedHttpMethod)context.getProperty(BaseHttpRequestTransport.HTTP_METHOD);
      if (method instanceof EntityEnclosingMethod) {
        RequestEntity requestEntity=method.getRequestEntity();
        if (requestEntity != null) {
          ByteArrayOutputStream tempOut=new ByteArrayOutputStream();
          requestEntity.writeRequest(tempOut);
          byte[] compressedData=CompressionSupport.compress(compressionAlg,tempOut.toByteArray());
          ((EntityEnclosingMethod)method).setRequestEntity(new ByteArrayRequestEntity(compressedData));
        }
      }
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
  }
}
