{
  if (checkedCredentials)   throw new CredentialsNotAvailableException("Missing valid credentials");
  if (authscheme == null) {
    return null;
  }
  try {
    String password=wsdlRequest.getPassword();
    if (password == null)     password="";
    if (authscheme instanceof NTLMScheme) {
      logger.info(host + ":" + port+ " requires Windows authentication");
      return new NTCredentials(wsdlRequest.getUsername(),password,host,wsdlRequest.getDomain());
    }
 else     if (authscheme instanceof RFC2617Scheme) {
      logger.info(host + ":" + port+ " requires authentication with the realm '"+ authscheme.getRealm()+ "'");
      return new UsernamePasswordCredentials(wsdlRequest.getUsername(),password);
    }
 else {
      throw new CredentialsNotAvailableException("Unsupported authentication scheme: " + authscheme.getSchemeName());
    }
  }
 catch (  IOException e) {
    throw new CredentialsNotAvailableException(e.getMessage(),e);
  }
 finally {
    checkedCredentials=true;
  }
}
