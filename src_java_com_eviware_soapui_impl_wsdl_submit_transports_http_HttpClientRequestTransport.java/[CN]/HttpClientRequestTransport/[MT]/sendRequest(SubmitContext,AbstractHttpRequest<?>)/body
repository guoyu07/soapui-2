{
  HttpClient httpClient=HttpClientSupport.getHttpClient();
  ExtendedHttpMethod httpMethod=createHttpMethod(httpRequest);
  boolean createdState=false;
  HttpState httpState=(HttpState)submitContext.getProperty(SubmitContext.HTTP_STATE_PROPERTY);
  if (httpState == null) {
    httpState=new HttpState();
    submitContext.setProperty(SubmitContext.HTTP_STATE_PROPERTY,httpState);
    createdState=true;
  }
  HostConfiguration hostConfiguration=new HostConfiguration();
  String localAddress=System.getProperty("soapui.bind.address",httpRequest.getBindAddress());
  if (localAddress == null || localAddress.trim().length() == 0)   localAddress=SoapUI.getSettings().getString(HttpSettings.BIND_ADDRESS,null);
  if (localAddress != null && localAddress.trim().length() > 0) {
    try {
      hostConfiguration.setLocalAddress(InetAddress.getByName(localAddress));
    }
 catch (    Exception e) {
      SoapUI.logError(e);
    }
  }
  submitContext.removeProperty(RESPONSE);
  submitContext.setProperty(HTTP_METHOD,httpMethod);
  submitContext.setProperty(POST_METHOD,httpMethod);
  submitContext.setProperty(HTTP_CLIENT,httpClient);
  Settings settings=httpRequest.getSettings();
  String compressionAlg=settings.getString(HttpSettings.REQUEST_COMPRESSION,"None");
  String requestContent=httpRequest.getRequestContent();
  if (!"None".equals(compressionAlg))   requestContent=new String(CompressionSupport.compress(compressionAlg,requestContent.getBytes()));
  submitContext.setProperty(REQUEST_CONTENT,requestContent);
  submitContext.setProperty(HOST_CONFIGURATION,hostConfiguration);
  submitContext.setProperty(WSDL_REQUEST,httpRequest);
  for (  RequestFilter filter : filters) {
    filter.filterRequest(submitContext,httpRequest);
  }
  try {
    StringToStringMap headers=httpRequest.getRequestHeaders();
    for (    String header : headers.keySet()) {
      String headerValue=headers.get(header);
      headerValue=PropertyExpansionUtils.expandProperties(submitContext,headerValue);
      httpMethod.setRequestHeader(header,headerValue);
    }
    WsdlProject project=(WsdlProject)ModelSupport.getModelItemProject(httpRequest);
    WssCrypto crypto=project.getWssContainer().getCryptoByName(httpRequest.getSslKeystore());
    if (crypto != null && WssCrypto.STATUS_OK.equals(crypto.getStatus())) {
      hostConfiguration.getParams().setParameter(SoapUIHostConfiguration.SOAPUI_SSL_CONFIG,crypto.getSource() + " " + crypto.getPassword());
    }
    httpMethod.setDumpFile(PropertyExpansionUtils.expandProperties(submitContext,httpRequest.getDumpFile()));
    if (settings.getBoolean(HttpSettings.INCLUDE_REQUEST_IN_TIME_TAKEN))     httpMethod.initStartTime();
    httpClient.executeMethod(hostConfiguration,httpMethod,httpState);
    httpMethod.getTimeTaken();
    for (    RequestFilter filter : filters) {
      filter.afterRequest(submitContext,httpRequest);
    }
    if (!submitContext.hasProperty(RESPONSE)) {
      createDefaultResponse(submitContext,httpRequest,httpMethod);
    }
  }
 catch (  Throwable t) {
    throw new Exception(t);
  }
 finally {
    if (httpMethod != null) {
      httpMethod.releaseConnection();
    }
 else     log.error("PostMethod is null");
    if (createdState)     submitContext.setProperty(SubmitContext.HTTP_STATE_PROPERTY,null);
  }
  return (Response)submitContext.getProperty(BaseHttpRequestTransport.RESPONSE);
}
