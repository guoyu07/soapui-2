{
  if (request instanceof WsdlRequest || request instanceof HttpTestRequest || request instanceof RestRequest) {
    if (sendAsBytesMessage) {
      return createBytesMessageFromText(submitContext,request,session);
    }
 else     if (hasAttachment(request)) {
      if (isTextAttachment(request)) {
        return createTextMessageFromAttachment(submitContext,request,session);
      }
 else {
        return createBytesMessage(request,session);
      }
    }
 else {
      return createTextMessage(submitContext,request,session);
    }
  }
  return null;
}
