{
  if (request == null) {
    throw new IllegalArgumentException("HTTP request may not be null");
  }
  if (conn == null) {
    throw new IllegalArgumentException("HTTP connection may not be null");
  }
  if (context == null) {
    throw new IllegalArgumentException("HTTP context may not be null");
  }
  HttpResponse response=null;
  int statuscode=0;
  while (response == null || statuscode < HttpStatus.SC_OK) {
    response=conn.receiveResponseHeader();
    RequestWrapper w=(RequestWrapper)request;
    SoapUIMetrics metrics=null;
    if (w.getOriginal() instanceof ExtendedHttpMethod) {
      metrics=((ExtendedHttpMethod)w.getOriginal()).getMetrics();
      metrics.getTimeToFirstByteTimer().stop();
      metrics.getReadTimer().start();
    }
    if (canResponseHaveBody(request,response)) {
      conn.receiveResponseEntity(response);
    }
    statuscode=response.getStatusLine().getStatusCode();
    SoapUIMetrics connectionMetrics=(SoapUIMetrics)conn.getMetrics();
    if (metrics != null && connectionMetrics != null && !connectionMetrics.isDone()) {
      metrics.getDNSTimer().set(connectionMetrics.getDNSTimer().getStart(),connectionMetrics.getDNSTimer().getStop());
      connectionMetrics.reset();
    }
  }
  return response;
}
