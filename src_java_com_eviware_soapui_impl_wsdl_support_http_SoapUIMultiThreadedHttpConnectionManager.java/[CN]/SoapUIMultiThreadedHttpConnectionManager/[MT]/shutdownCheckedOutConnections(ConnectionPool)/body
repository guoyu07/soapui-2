{
  ArrayList<DefaultClientConnection> connectionsToClose=new ArrayList<DefaultClientConnection>();
synchronized (REFERENCE_TO_CONNECTION_SOURCE) {
    Iterator referenceIter=REFERENCE_TO_CONNECTION_SOURCE.keySet().iterator();
    while (referenceIter.hasNext()) {
      Reference ref=(Reference)referenceIter.next();
      ConnectionSource source=(ConnectionSource)REFERENCE_TO_CONNECTION_SOURCE.get(ref);
      if (source.connectionPool == connectionPool) {
        referenceIter.remove();
        DefaultClientConnection connection=(DefaultClientConnection)ref.get();
        if (connection != null) {
          connectionsToClose.add(connection);
        }
      }
    }
  }
  for (Iterator i=connectionsToClose.iterator(); i.hasNext(); ) {
    DefaultClientConnection connection=(DefaultClientConnection)i.next();
    try {
      connection.close();
    }
 catch (    IOException e) {
      SoapUI.logError(e);
    }
  }
}
