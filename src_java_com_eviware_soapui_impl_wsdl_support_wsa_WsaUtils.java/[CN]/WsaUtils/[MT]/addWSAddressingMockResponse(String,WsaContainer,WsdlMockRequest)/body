{
  try {
    Element header=addWsAddressingCommon(content,wsaContainer);
    String action=wsaContainer.getWsaConfig().getAction();
    if (SoapUI.getSettings().getBoolean(WsaSettings.USE_DEFAULT_ACTION)) {
      if (action == null || action.isEmpty()) {
        WsdlUtils.createDefaultedAction((WsdlMockResponse)wsaContainer);
      }
    }
    header.appendChild(builder.createWsaChildElement("wsa:Action",elm,wsaContainer.getWsaConfig().getAction()));
    String replyTo=wsaContainer.getWsaConfig().getReplyTo();
    if (replyTo != null && replyTo.length() > 0) {
      header.appendChild(builder.createWsaAddressChildElement("wsa:ReplyTo",elm,replyTo));
    }
    XmlObject requestXmlObject=request.getRequestXmlObject();
    Element requestHeader=(Element)SoapUtils.getHeaderElement(requestXmlObject,request.getSoapVersion(),true).getDomNode();
    NodeList msgIds=requestHeader.getElementsByTagNameNS(wsaVersionNameSpace,"MessageID");
    String requestMessageId=null;
    if (msgIds.getLength() > 0) {
      requestMessageId=msgIds.item(0).getFirstChild().getNodeValue();
    }
    NodeList repliesTo=requestHeader.getElementsByTagNameNS(wsaVersionNameSpace,"ReplyTo");
    Node replyToNode=repliesTo.item(0);
    String requestReplyTo=null;
    if (replyToNode != null) {
      NodeList replyToAddresses=replyToNode.getChildNodes();
      if (replyToAddresses.getLength() > 0) {
        requestReplyTo=replyToAddresses.item(0).getFirstChild().getNodeValue();
      }
    }
    String to=wsaContainer.getWsaConfig().getTo();
    if (to != null && to.length() > 0) {
      header.appendChild(builder.createWsaAddressChildElement("wsa:To",elm,to));
    }
 else {
      header.appendChild(builder.createWsaAddressChildElement("wsa:To",elm,requestReplyTo));
    }
    String relationshipType=wsaContainer.getWsaConfig().getRelationshipType();
    if (relationshipType != null && relationshipType.length() > 0) {
      header.appendChild(builder.createRelatesToElement("wsa:RelatesTo",elm,relationshipType,requestMessageId));
    }
 else     if (wsaContainer instanceof WsdlMockResponse) {
      if (SoapUI.getSettings().getBoolean(WsaSettings.USE_DEFAULT_RELATIONSHIP_TYPE)) {
        header.appendChild(builder.createRelatesToElement("wsa:RelatesTo",elm,relatesToReply,requestMessageId));
      }
    }
    String msgId=wsaContainer.getWsaConfig().getMessageID();
    if (msgId != null && msgId.length() > 0) {
      header.appendChild(builder.createWsaChildElement("wsa:MessageID",elm,msgId));
    }
    content=xmlObject.xmlText();
  }
 catch (  XmlException e) {
    SoapUI.logError(e);
  }
  return content;
}
