{
  AbstractSecurityCheckFactory factory=SoapUI.getSoapUICore().getSecurityCheckRegistry().getFactory(securityCheckType);
  SecurityCheckConfig newSecCheckConfig=factory.createNewSecurityCheck(securityCheckName);
  AbstractSecurityCheck newSecCheck=null;
  boolean hasChecks=false;
  List<TestStepSecurityTestConfig> testStepSecurityTestList=getConfig().getTestStepSecurityTestList();
  if (!testStepSecurityTestList.isEmpty()) {
    for (int i=0; i < testStepSecurityTestList.size(); i++) {
      TestStepSecurityTestConfig testStepSecurityTest=testStepSecurityTestList.get(i);
      if (testStepSecurityTest.getTestStepId().equals(testStep.getId())) {
        newSecCheck=addSecurityCheck(factory,newSecCheckConfig,testStepSecurityTest,testStep);
        hasChecks=true;
        break;
      }
    }
  }
  if (!hasChecks) {
    TestStepSecurityTestConfig testStepSecurityTest=getConfig().addNewTestStepSecurityTest();
    testStepSecurityTest.setTestStepId(testStep.getId());
    newSecCheck=addSecurityCheck(factory,newSecCheckConfig,testStepSecurityTest,testStep);
  }
  if (listModel != null)   listModel.securityCheckAdded(newSecCheck);
  addSecurityCheckByTestStepId(testStep.getId(),newSecCheck);
  return newSecCheck;
}
