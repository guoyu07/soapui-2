{
  AbstractSecurityCheckFactory factory=SecurityCheckRegistry.getInstance().getFactory(securityCheckType);
  SecurityCheckConfig newSecCheckConfig=factory.createNewSecurityCheck(securityCheckName);
  AbstractSecurityCheck newSecCheck=factory.buildSecurityCheck(newSecCheckConfig,this);
  newSecCheck.setTestStep(testStep);
  boolean hasChecks=false;
  List<TestStepSecurityTestConfig> testStepSecurityTestList=getConfig().getTestStepSecurityTestList();
  if (!testStepSecurityTestList.isEmpty()) {
    for (    TestStepSecurityTestConfig testStepSecurityTest : testStepSecurityTestList) {
      if (testStepSecurityTest.getTestStepId().equals(testStep.getId())) {
        List<SecurityCheckConfig> securityCheckList=testStepSecurityTest.getTestStepSecurityCheckList();
        securityCheckList.add(newSecCheck.getConfig());
        hasChecks=true;
      }
    }
  }
  if (!hasChecks) {
    TestStepSecurityTestConfig testStepSecurityTest=getConfig().addNewTestStepSecurityTest();
    testStepSecurityTest.setTestStepId(testStep.getId());
    SecurityCheckConfig newSecurityCheck=testStepSecurityTest.addNewTestStepSecurityCheck();
    newSecurityCheck.setConfig(newSecCheckConfig.getConfig());
    newSecurityCheck.setType(newSecCheck.getType());
    newSecurityCheck.setName(newSecCheck.getName());
  }
  if (listModel != null)   listModel.securityCheckAdded(newSecCheck);
  newSecCheck.setTestStep(testStep);
  return newSecCheck;
}
