{
  WsdlTestCase testCase=getTestRunnable();
  if (testCase.getKeepSession()) {
    runContext.setProperty(SubmitContext.HTTP_STATE_PROPERTY,new HttpState());
  }
  testCaseRunListeners=testCase.getTestRunListeners();
  testCase.runSetupScript(runContext,this);
  if (!super.isRunning())   return;
  if (testCase.getTimeout() > 0) {
    startTimeoutTimer(testCase.getTimeout());
  }
  super.notifyBeforeRun();
  if (!super.isRunning())   return;
  initCount=0;
  setStartTime();
  for (; initCount < testCase.getTestStepCount() && isRunning(); initCount++) {
    WsdlTestStep testStep=testCase.getTestStepAt(initCount);
    if (testStep.isDisabled())     continue;
    try {
      testStep.prepare(this,runContext);
    }
 catch (    Exception e) {
      setStatus(Status.FAILED);
      SoapUI.logError(e);
      throw new Exception("Failed to prepare testStep [" + testStep.getName() + "]; "+ e.toString());
    }
  }
  int currentStepIndex=startStep;
  runContext.setCurrentStep(currentStepIndex);
  for (; isRunning() && currentStepIndex < testCase.getTestStepCount(); currentStepIndex++) {
    TestStep currentStep=runContext.getCurrentStep();
    if (!currentStep.isDisabled()) {
      TestStepResult stepResult=runTestStep(currentStep,true,true);
      if (stepResult == null)       return;
      if (!isRunning())       return;
    }
    runContext.setCurrentStep(currentStepIndex + 1);
  }
  if (runContext.getProperty(TestCaseRunner.Status.class.getName()) == TestCaseRunner.Status.FAILED && testCase.getFailTestCaseOnErrors()) {
    fail("Failing due to failed test step");
  }
}
