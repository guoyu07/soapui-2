{
  securityTest.getTestCase().beforeSave();
  listeners=securityTest.getTestRunListeners();
  hasTornDown=false;
  context=new WsdlTestRunContext(this,new StringToObjectMap());
  try {
    securityTest.runStartupScript(context,this);
  }
 catch (  Exception e1) {
    SoapUI.logError(e1);
  }
  status=Status.RUNNING;
  if (status == Status.RUNNING) {
    WsdlTestCase testCase=securityTest.getTestCase();
    List<TestStep> testStepsList=testCase.getTestStepList();
    HashMap<String,List<SecurityCheck>> secCheckMap=securityTest.getSecurityChecksMap();
    SecurityTestRunnerImpl testCaseRunner=new SecurityTestRunnerImpl(securityTest);
    notifyBeforeRun();
    for (int j=0; j < testStepsList.size(); j++) {
      TestStep testStep=testStepsList.get(j);
      if (!testStep.isDisabled()) {
        for (int i=0; i < listeners.length; i++) {
          listeners[i].beforeStep(this,getRunContext(),testStep);
          if (!isRunning())           return;
        }
        TestStepResult stepResult=testCaseRunner.runTestStepByName(testStep.getName());
        if (secCheckMap.containsKey(testStep.getId())) {
          List<SecurityCheck> testStepChecksList=secCheckMap.get(testStep.getId());
          for (          SecurityCheck securityCheck : testStepChecksList) {
            if (securityCheck.acceptsTestStep(testStep)) {
              securityCheck.run(cloneForSecurityCheck((WsdlTestStep)testStep),context,securityTest.getSecurityTestLog());
            }
          }
        }
        for (int i=0; i < listeners.length; i++) {
          listeners[i].afterStep(this,getRunContext(),stepResult);
        }
      }
    }
    if (status == Status.RUNNING) {
      status=Status.FINISHED;
    }
    notifyAfterRun();
  }
  stop();
}
