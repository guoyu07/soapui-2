{
  this.securityCheck=securityCheck;
  testCase=securityCheck.getTestStep().getTestCase();
  project=testCase.getTestSuite().getProject();
  if (dialog == null) {
    dialog=ADialogBuilder.buildDialog(CloneParameterDialog.class);
    dialog.getFormField(CloneParameterDialog.TARGET_TESTSUITE).addFormFieldListener(new XFormFieldListener(){
      public void valueChanged(      XFormField sourceField,      String newValue,      String oldValue){
        TestSuite testSuite=project.getTestSuiteByName(newValue);
        String[] testCaseNames=ModelSupport.getNames(testSuite.getTestCaseList());
        dialog.setOptions(CloneParameterDialog.TARGET_TESTCASE,testCaseNames);
        if (testCaseNames.length > 0) {
          dialog.setValue(CloneParameterDialog.TARGET_TESTCASE,testCaseNames[0]);
          TestCase testCase=testSuite.getTestCaseByName(testCaseNames[0]);
          String[] testStepNames=ModelSupport.getNames(testCase.getTestStepList());
          dialog.setOptions(CloneParameterDialog.TARGET_TESTSTEP,testStepNames);
          String[] securityTestNames=ModelSupport.getNames(testCase.getSecurityTestList());
          dialog.setOptions(CloneParameterDialog.TARGET_SECURITYTEST,securityTestNames);
          if (testStepNames.length > 0) {
            dialog.setValue(CloneParameterDialog.TARGET_TESTSTEP,testStepNames[0]);
          }
 else {
            dialog.setOptions(CloneParameterDialog.TARGET_TESTSTEP,new String[0]);
          }
          if (securityTestNames.length > 0) {
            dialog.setValue(CloneParameterDialog.TARGET_SECURITYTEST,securityTestNames[0]);
          }
 else {
            dialog.setOptions(CloneParameterDialog.TARGET_SECURITYTEST,new String[0]);
          }
        }
 else {
          dialog.setOptions(CloneParameterDialog.TARGET_SECURITYTEST,new String[0]);
          dialog.setOptions(CloneParameterDialog.TARGET_TESTSTEP,new String[0]);
        }
      }
    }
);
    dialog.getFormField(CloneParameterDialog.TARGET_TESTCASE).addFormFieldListener(new XFormFieldListener(){
      public void valueChanged(      XFormField sourceField,      String newValue,      String oldValue){
        String testSuiteName=dialog.getValue(CloneParameterDialog.TARGET_TESTSUITE);
        TestSuite testSuite=project.getTestSuiteByName(testSuiteName);
        TestCase testCase=testSuite.getTestCaseByName(newValue);
        String[] testStepNames=ModelSupport.getNames(testCase.getTestStepList());
        dialog.setOptions(CloneParameterDialog.TARGET_TESTSTEP,testStepNames);
        String[] securityTestNames=ModelSupport.getNames(testCase.getSecurityTestList());
        dialog.setOptions(CloneParameterDialog.TARGET_SECURITYTEST,securityTestNames);
        if (testStepNames.length > 0) {
          dialog.setValue(CloneParameterDialog.TARGET_TESTSTEP,testStepNames[0]);
        }
 else {
          dialog.setOptions(CloneParameterDialog.TARGET_TESTSTEP,new String[0]);
        }
        if (securityTestNames.length > 0) {
          dialog.setValue(CloneParameterDialog.TARGET_SECURITYTEST,securityTestNames[0]);
        }
 else {
          dialog.setOptions(CloneParameterDialog.TARGET_SECURITYTEST,new String[0]);
        }
      }
    }
);
    dialog.getFormField(CloneParameterDialog.TARGET_TESTSTEP).addFormFieldListener(new XFormFieldListener(){
      public void valueChanged(      XFormField sourceField,      String newValue,      String oldValue){
        String testSuiteName=dialog.getValue(CloneParameterDialog.TARGET_TESTSUITE);
        TestSuite testSuite=project.getTestSuiteByName(testSuiteName);
        String testCaseName=dialog.getValue(CloneParameterDialog.TARGET_TESTCASE);
        TestCase testCase=testSuite.getTestCaseByName(testCaseName);
        String securityTestName=dialog.getValue(CloneParameterDialog.TARGET_SECURITYTEST);
        SecurityTest securityTest=testCase.getSecurityTestByName(securityTestName);
        TestStep testStep=testCase.getTestStepByName(newValue);
        String[] securityCheckNames=ModelSupport.getNames(securityTest.getTestStepSecurityChecks(testStep.getId()));
        dialog.setOptions(CloneParameterDialog.TARGET_SECURITYCHECK,securityCheckNames);
      }
    }
);
    dialog.getFormField(CloneParameterDialog.TARGET_SECURITYTEST).addFormFieldListener(new XFormFieldListener(){
      public void valueChanged(      XFormField sourceField,      String newValue,      String oldValue){
        String testSuiteName=dialog.getValue(CloneParameterDialog.TARGET_TESTSUITE);
        TestSuite testSuite=project.getTestSuiteByName(testSuiteName);
        String testCaseName=dialog.getValue(CloneParameterDialog.TARGET_TESTCASE);
        TestCase testCase=testSuite.getTestCaseByName(testCaseName);
        SecurityTest securityTest=testCase.getSecurityTestByName(newValue);
        String testStepName=dialog.getValue(CloneParameterDialog.TARGET_TESTSTEP);
        TestStep testStep=testCase.getTestStepByName(testStepName);
        String[] securityCheckNames=ModelSupport.getNames(securityTest.getTestStepSecurityChecks(testStep.getId()));
        dialog.setOptions(CloneParameterDialog.TARGET_SECURITYCHECK,securityCheckNames);
      }
    }
);
    dialog.addAction(new ApplyAction());
  }
  WsdlTestCase testCase=(WsdlTestCase)securityCheck.getTestStep().getTestCase();
  dialog.setOptions(CloneParameterDialog.TARGET_TESTSUITE,ModelSupport.getNames(testCase.getTestSuite().getProject().getTestSuiteList()));
  dialog.setValue(CloneParameterDialog.TARGET_TESTSUITE,testCase.getTestSuite().getName());
  List<TestCase> testCaseList=testCase.getTestSuite().getTestCaseList();
  dialog.setOptions(CloneParameterDialog.TARGET_TESTCASE,ModelSupport.getNames(testCaseList));
  dialog.setValue(CloneParameterDialog.TARGET_TESTCASE,testCase.getName());
  dialog.setOptions(CloneParameterDialog.TARGET_TESTSTEP,ModelSupport.getNames(testCase.getTestStepList()));
  dialog.setOptions(CloneParameterDialog.TARGET_SECURITYTEST,ModelSupport.getNames(testCase.getSecurityTestList()));
  String securityTestName=dialog.getValue(CloneParameterDialog.TARGET_SECURITYTEST);
  SecurityTest securityTest=testCase.getSecurityTestByName(securityTestName);
  String testStepName=dialog.getValue(CloneParameterDialog.TARGET_TESTSTEP);
  TestStep testStep=testCase.getTestStepByName(testStepName);
  String[] securityCheckNames=ModelSupport.getNames(securityTest.getTestStepSecurityChecks(testStep.getId()));
  dialog.setOptions(CloneParameterDialog.TARGET_SECURITYCHECK,securityCheckNames);
  dialog.setOptions(CloneParameterDialog.PARAMETERS,ModelSupport.getNames(securityCheck.getParameterHolder().getParameterList()));
  if (dialog.show()) {
    List<ModelItem> items=performClone();
    if (items.size() > 0) {
      UISupport.showDesktopPanel(new ModelItemListDesktopPanel("Updated SecurityChecks","The following SecurityChecks where updated with new parameters",items.toArray(new ModelItem[items.size()])));
    }
 else {
      UISupport.showInfoMessage("Updated " + items.size() + " checks");
    }
  }
}
