{
  if (ProxyUtils.isProxyEnabled()) {
    ProxyUtils.setProxyEnabled(false);
    SoapUI.getSettings().setBoolean(ProxySettings.ENABLE_PROXY,false);
    applyProxyButton.setIcon(UISupport.createImageIcon(PROXY_DISABLED_ICON));
  }
 else {
    if (StringUtils.isNullOrEmpty(SoapUI.getSettings().getString(ProxySettings.HOST,"")) || StringUtils.isNullOrEmpty(SoapUI.getSettings().getString(ProxySettings.PORT,""))) {
      SoapUIPreferencesAction.getInstance().show(SoapUIPreferencesAction.PROXY_SETTINGS);
      if (!StringUtils.isNullOrEmpty(SoapUI.getSettings().getString(ProxySettings.HOST,"")) && !StringUtils.isNullOrEmpty(SoapUI.getSettings().getString(ProxySettings.PORT,""))) {
        ProxyUtils.setProxyEnabled(true);
        SoapUI.getSettings().setBoolean(ProxySettings.ENABLE_PROXY,true);
        applyProxyButton.setIcon(UISupport.createImageIcon(PROXY_ENABLED_ICON));
      }
    }
 else {
      ProxyUtils.setProxyEnabled(true);
      SoapUI.getSettings().setBoolean(ProxySettings.ENABLE_PROXY,true);
      applyProxyButton.setIcon(UISupport.createImageIcon(PROXY_ENABLED_ICON));
    }
  }
}
